<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Planner Fundraiser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        /* Page routing */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .admin-link {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .admin-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Goal Section */
        .goal-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 3px solid #667eea;
        }

        .progress-container {
            margin-bottom: 20px;
        }

        .progress-bar-bg {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .goal-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .stat-box {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            color: #667eea;
            font-weight: bold;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Content */
        .content {
            padding: 30px;
        }

        .purpose {
            margin-bottom: 30px;
            padding: 20px;
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            border-radius: 8px;
        }

        .purpose h2 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        /* QR Section */
        .qr-section {
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            background: #fff;
            border: 2px dashed #667eea;
            border-radius: 12px;
        }

        .qr-section h3 {
            color: #667eea;
            margin-bottom: 20px;
        }



        .qr-instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            color: #856404;
            font-size: 0.95rem;
            margin-top: 15px;
        }

        /* Donation Form */
        .donation-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .donation-form h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .success-message {
            display: none;
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            border: 2px solid #c3e6cb;
        }

        .success-message.show {
            display: block;
        }

        /* Donations List */
        .donations-list {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .donations-list h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .donation-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .donor-name {
            font-weight: 600;
            color: #333;
        }

        .donation-amount {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .no-donations {
            text-align: center;
            color: #999;
            padding: 20px;
        }

        /* Admin Page Styles */
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Login Form */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .login-container h2 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Admin Dashboard */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .admin-stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #667eea;
        }

        .admin-stat-value {
            font-size: 2.5rem;
            color: #667eea;
            font-weight: bold;
        }

        .admin-stat-label {
            color: #666;
            margin-top: 10px;
        }

        /* Donations Table */
        .donations-table-container {
            padding: 30px;
            overflow-x: auto;
        }

        .donations-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .donations-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .donations-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .donations-table tr:hover {
            background: #f8f9fa;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .edit-btn {
            background: #667eea;
            color: white;
        }

        .edit-btn:hover {
            background: #5568d3;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        /* Edit Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #667eea;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Goal Showcase */
        .goal-showcase {
            padding: 30px;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .goal-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid #eee;
        }

        @media (min-width: 768px) {
            .goal-card {
                flex-direction: row;
                align-items: center;
            }
        }

        .goal-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }

        @media (min-width: 768px) {
            .goal-image {
                width: 50%;
                height: 300px;
                border-bottom: none;
                border-right: 1px solid #eee;
            }
        }

        .goal-details {
            padding: 25px;
            flex: 1;
        }

        .goal-title {
            font-size: 1.4rem;
            color: #2d3748;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .goal-price {
            font-size: 1.2rem;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .product-link {
            display: inline-block;
            background: #2d3748;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .product-link:hover {
            background: #1a202c;
            transform: translateY(-2px);
        }

        .original-price {
            text-decoration: line-through;
            color: #a0aec0;
            font-size: 1rem;
            margin-right: 10px;
        }

        .current-price {
            color: #e53e3e;
            font-size: 1.4rem;
            font-weight: 700;
        }


        .qr-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            padding: 10px;
            width: 100%;
        }

        .qr-image {
            max-width: 250px;
            width: 100%;
            height: auto;
            border-radius: 12px;
            border: 2px solid #eee;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .upi-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            margin: 15px auto;
            border: 1px dashed #cbd5e0;
            max-width: 350px;
        }

        .upi-text {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            color: #2d3748;
            font-weight: 600;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #5a67d8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .goal-stats {
                flex-direction: column;
                gap: 20px;
            }

            .donations-table {
                font-size: 0.9rem;
            }

            .donations-table th,
            .donations-table td {
                padding: 10px;
            }

            .admin-link {
                position: static;
                display: inline-block;
                margin-top: 10px;
            }
        }
    </style>
</head>

<body>
    <!-- Main Donation Page -->
    <div id="mainPage" class="page active">
        <div class="container">
            <div class="header">
                <h1>üéØ Help Me Get a 2026 Planner!</h1>
                <p>Your support means the world to me</p>
                <a href="#/stats" class="admin-link" onclick="navigateToStats(event)">üîí Admin</a>
            </div>

            <div class="goal-section">
                <div class="progress-container">
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="progressBar">0%</div>
                    </div>
                </div>
                <div class="goal-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="raisedAmount">‚Çπ0</div>
                        <div class="stat-label">Raised</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">‚Çπ2,280</div>
                        <div class="stat-label">Goal</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="donorCount">0</div>
                        <div class="stat-label">Supporters</div>
                    </div>
                </div>
            </div>

            <!-- Goal Showcase Section -->
            <div class="goal-showcase">
                <div class="goal-card">
                    <img src="assets/planner-preview.jpg" alt="Big A** Calendar 2026" class="goal-image">
                    <div class="goal-details">
                        <h2 class="goal-title">The Goal: Big A** Calendar 2026</h2>
                        <div class="goal-price">
                            <span class="original-price">‚Çπ3,680</span>
                            <span class="current-price">‚Çπ2,280</span>
                            <span style="font-size: 0.9rem; color: #48bb78; margin-left: 5px;">(38% OFF)</span>
                        </div>
                        <p style="color: #666; line-height: 1.6; margin-bottom: 20px;">
                            This isn't just a calendar; it's a productivity system on canvas.
                            Help me get this massive visual planner to track habits,
                            stay consistent, and crush my goals in 2026!
                        </p>
                        <a href="https://goodhabitsclub.in/product/big-calendar-canvas-red" target="_blank"
                            class="product-link">
                            üîó View Official Store
                        </a>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="purpose">
                    <h2>üìñ Why This Matters</h2>
                    <p>
                        I'm raising funds to purchase a 2026 planner that will help me stay organized,
                        set goals, and make the most of the coming year. Your contribution, no matter
                        how small, will help me start 2026 on the right foot with better planning and
                        productivity!
                    </p>
                </div>

                <div class="qr-section">
                    <h3>üí≥ Scan to Donate via GPay</h3>
                    <div class="qr-placeholder">
                        <img src="assets/payment-qr.jpeg" alt="GPay QR" class="qr-image">
                    </div>

                    <div class="upi-container">
                        <span class="upi-text" id="upiId">ygcja-1@oksbi</span>
                        <button class="copy-btn" onclick="copyUpi()">üìã Copy</button>
                    </div>

                    <div class="qr-instructions">
                        <strong>üì± How to Donate:</strong>
                        <ul style="text-align: left; margin-top: 10px; padding-left: 20px;">
                            <li><strong>On Mobile:</strong> Take a screenshot of this QR code ‚Üí Open GPay/PhonePe ‚Üí Scan
                                ‚Üí Upload from Gallery.</li>
                            <li><strong>On PC:</strong> Open any UPI app on your phone and scan the code directly.</li>
                            <li><strong>Alternative:</strong> Copy the UPI ID above and pay manually.</li>
                        </ul>
                        <div style="margin-top: 15px;">
                            Once done, fill the form below so I can thank you! üëá
                        </div>
                    </div>
                </div>

                <div class="donation-form">
                    <h3>‚úçÔ∏è Record Your Contribution</h3>
                    <form id="donationForm">
                        <div class="form-group">
                            <label for="donorName">Your Name *</label>
                            <input type="text" id="donorName" required placeholder="Enter your name">
                        </div>

                        <div class="form-group">
                            <label for="amount">Donation Amount (‚Çπ) *</label>
                            <input type="number" id="amount" required min="1" placeholder="Enter amount donated">
                        </div>

                        <div class="form-group">
                            <label for="message">Message (Optional)</label>
                            <textarea id="message" placeholder="Leave a message of support"></textarea>
                        </div>

                        <button type="submit" class="submit-btn">‚úÖ Record My Donation</button>
                    </form>

                    <div class="success-message" id="successMessage">
                        <strong>üéâ Thank You!</strong><br>
                        Your contribution has been recorded. I truly appreciate your support!
                    </div>
                </div>


            </div>
        </div>
    </div>

    <!-- Admin Stats Page -->
    <div id="statsPage" class="page">
        <!-- Login Screen -->
        <div id="loginScreen">
            <div class="login-container">
                <h2>üîí Admin Login</h2>
                <div class="error-message" id="loginError">Invalid password</div>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" required placeholder="Enter admin password">
                    </div>
                    <button type="submit" class="submit-btn">Login</button>
                </form>
                <div style="text-align: center; margin-top: 20px;">
                    <a href="#/" class="back-btn" onclick="navigateToHome(event)" style="display: inline-block;">‚Üê Back
                        to Main Page</a>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" style="display: none;">
            <div class="container">
                <div class="header">
                    <div class="admin-header">
                        <div>
                            <h1>üìä Admin Dashboard</h1>
                            <p>Manage donations and track progress</p>
                        </div>
                        <a href="#/" class="back-btn" onclick="navigateToHome(event)">‚Üê Back to Main</a>
                    </div>
                </div>

                <div class="admin-stats">
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="adminTotalRaised">‚Çπ0</div>
                        <div class="admin-stat-label">Total Raised</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="adminTotalDonors">0</div>
                        <div class="admin-stat-label">Total Donors</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-value" id="adminAvgDonation">‚Çπ0</div>
                        <div class="admin-stat-label">Avg Donation</div>
                    </div>
                </div>

                <div class="donations-table-container">
                    <h3 style="color: #667eea; margin-bottom: 20px;">All Donations</h3>
                    <div id="adminDonationsList">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading donations...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Donation</h3>
                <button class="close-btn" onclick="closeEditModal()">√ó</button>
            </div>
            <form id="editForm">
                <input type="hidden" id="editDonationId">
                <div class="form-group">
                    <label for="editName">Donor Name</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editAmount">Amount (‚Çπ)</label>
                    <input type="number" id="editAmount" required min="1">
                </div>
                <div class="form-group">
                    <label for="editMessage">Message</label>
                    <textarea id="editMessage"></textarea>
                </div>
                <button type="submit" class="submit-btn">Save Changes</button>
            </form>
        </div>
    </div>

    <script>
        // Configuration
        const ADMIN_PASSWORDHASH = '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9';
        const GOAL_AMOUNT = 2280;
        let isAdminLoggedIn = false;

        // Polyfill for window.storage using localStorage
        if (!window.storage) {
            window.storage = {
                set: async (key, value) => {
                    localStorage.setItem(key, value);
                    return true;
                },
                get: async (key) => {
                    return { value: localStorage.getItem(key) };
                },
                list: async (prefix) => {
                    const keys = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith(prefix)) {
                            keys.push(key);
                        }
                    }
                    return { keys: keys };
                },
                delete: async (key) => {
                    localStorage.removeItem(key);
                    return true;
                }
            };
        }

        // Storage keys
        const STORAGE_PREFIX = 'donation_';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
        });

        async function initializeApp() {
            // Handle initial route
            handleRoute();

            // Set up event listeners
            document.getElementById('donationForm').addEventListener('submit', handleDonationSubmit);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('editForm').addEventListener('submit', handleEditSubmit);

            // Load donations for main page
            await loadDonations();
        }

        // Routing
        function handleRoute() {
            const hash = window.location.hash;
            if (hash === '#/stats') {
                showStatsPage();
            } else {
                showMainPage();
            }
        }

        function navigateToStats(e) {
            e.preventDefault();
            window.location.hash = '#/stats';
            showStatsPage();
        }

        function navigateToHome(e) {
            e.preventDefault();
            window.location.hash = '#/';
            showMainPage();
        }

        function showMainPage() {
            document.getElementById('mainPage').classList.add('active');
            document.getElementById('statsPage').classList.remove('active');
            loadDonations();
        }

        function showStatsPage() {
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('statsPage').classList.add('active');
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
            isAdminLoggedIn = false;
        }

        // Donation submission
        async function handleDonationSubmit(e) {
            e.preventDefault();

            const name = document.getElementById('donorName').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const message = document.getElementById('message').value.trim();

            if (!name || !amount || amount <= 0) {
                alert('Please enter valid name and amount');
                return;
            }

            try {
                // Create unique ID
                const donationId = 'don_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

                // Create donation object
                const donation = {
                    id: donationId,
                    name: name,
                    amount: amount,
                    message: message,
                    timestamp: new Date().toISOString()
                };

                // Store in persistent storage
                await window.storage.set(
                    STORAGE_PREFIX + donationId,
                    JSON.stringify(donation),
                    true // shared storage
                );

                // Show success message
                document.getElementById('successMessage').classList.add('show');
                document.getElementById('donationForm').reset();

                // Reload donations
                await loadDonations();

                // Hide success message after 5 seconds
                setTimeout(() => {
                    document.getElementById('successMessage').classList.remove('show');
                }, 5000);

                // Scroll to success message
                document.getElementById('successMessage').scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest'
                });

            } catch (error) {
                console.error('Error saving donation:', error);
                alert('Failed to save donation. Please try again.');
            }
        }

        // Load all donations
        async function loadDonations() {
            try {
                // Get all donation keys
                const result = await window.storage.list(STORAGE_PREFIX, true);

                if (!result || !result.keys || result.keys.length === 0) {
                    displayNoDonations();
                    updateMainPageStats([], 0);
                    return;
                }

                // Fetch all donations
                const donations = [];
                for (const key of result.keys) {
                    try {
                        const donationResult = await window.storage.get(key, true);
                        if (donationResult && donationResult.value) {
                            const donation = JSON.parse(donationResult.value);
                            donations.push(donation);
                        }
                    } catch (err) {
                        console.error('Error loading donation:', key, err);
                    }
                }

                // Sort by timestamp (newest first)
                donations.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                // Calculate total
                const total = donations.reduce((sum, d) => sum + d.amount, 0);

                // Update displays
                displayDonations(donations);
                updateMainPageStats(donations, total);

            } catch (error) {
                console.error('Error loading donations:', error);
                displayNoDonations();
            }
        }

        // Display donations on main page
        function displayDonations(donations) {
            const container = document.getElementById('donationsList');
            if (!container) return;

            if (donations.length === 0) {
                container.innerHTML = '<div class="no-donations">Be the first to contribute! üåü</div>';
                return;
            }

            let html = '';
            donations.forEach(donation => {
                html += `
                    <div class="donation-item">
                        <div>
                            <div class="donor-name">${escapeHtml(donation.name)}</div>
                            ${donation.message ? `<div style="font-size: 0.9rem; color: #666; margin-top: 5px;">"${escapeHtml(donation.message)}"</div>` : ''}
                            <div style="font-size: 0.8rem; color: #999; margin-top: 5px;">${formatDate(donation.timestamp)}</div>
                        </div>
                        <div class="donation-amount">‚Çπ${donation.amount}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function displayNoDonations() {
            const container = document.getElementById('donationsList');
            if (!container) return;
            container.innerHTML = '<div class="no-donations">Be the first to contribute! üåü</div>';
        }

        // Update stats on main page
        function updateMainPageStats(donations, total) {
            const percentage = Math.min((total / GOAL_AMOUNT) * 100, 100);

            document.getElementById('raisedAmount').textContent = `‚Çπ${total}`;
            document.getElementById('donorCount').textContent = donations.length;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressBar').textContent = `${Math.round(percentage)}%`;
        }

        // Admin login
        async function handleLogin(e) {
            e.preventDefault();

            const password = document.getElementById('adminPassword').value;
            const hashedPassword = await hashPassword(password);

            if (hashedPassword === ADMIN_PASSWORD_HASH) {
                isAdminLoggedIn = true;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                document.getElementById('loginError').classList.remove('show');
                loadAdminDashboard();
            } else {
                document.getElementById('loginError').classList.add('show');
            }
        }

        async function hashPassword(string) {
            const utf8 = new TextEncoder().encode(string);
            const hashBuffer = await crypto.subtle.digest('SHA-256', utf8);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Load admin dashboard
        async function loadAdminDashboard() {
            try {
                // Get all donations
                const result = await window.storage.list(STORAGE_PREFIX, true);

                if (!result || !result.keys || result.keys.length === 0) {
                    displayNoAdminDonations();
                    updateAdminStats([], 0);
                    return;
                }

                const donations = [];
                for (const key of result.keys) {
                    try {
                        const donationResult = await window.storage.get(key, true);
                        if (donationResult && donationResult.value) {
                            const donation = JSON.parse(donationResult.value);
                            donations.push(donation);
                        }
                    } catch (err) {
                        console.error('Error loading donation:', key, err);
                    }
                }

                donations.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                const total = donations.reduce((sum, d) => sum + d.amount, 0);

                updateAdminStats(donations, total);
                displayAdminTable(donations);

            } catch (error) {
                console.error('Error loading admin dashboard:', error);
                displayNoAdminDonations();
            }
        }

        // Update admin stats
        function updateAdminStats(donations, total) {
            const avgDonation = donations.length > 0 ? Math.round(total / donations.length) : 0;

            document.getElementById('adminTotalRaised').textContent = `‚Çπ${total}`;
            document.getElementById('adminTotalDonors').textContent = donations.length;
            document.getElementById('adminAvgDonation').textContent = `‚Çπ${avgDonation}`;
        }

        // Display admin table
        function displayAdminTable(donations) {
            const container = document.getElementById('adminDonationsList');

            if (donations.length === 0) {
                container.innerHTML = '<div class="no-donations">No donations yet</div>';
                return;
            }

            let html = `
                <table class="donations-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Donor Name</th>
                            <th>Amount</th>
                            <th>Message</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            donations.forEach(donation => {
                html += `
                    <tr>
                        <td>${formatDate(donation.timestamp)}</td>
                        <td>${escapeHtml(donation.name)}</td>
                        <td>‚Çπ${donation.amount}</td>
                        <td>${escapeHtml(donation.message || '-')}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editDonation('${donation.id}')">‚úèÔ∏è Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteDonation('${donation.id}')">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function displayNoAdminDonations() {
            const container = document.getElementById('adminDonationsList');
            container.innerHTML = '<div class="no-donations">No donations yet</div>';
        }

        // Edit donation
        async function editDonation(donationId) {
            try {
                const result = await window.storage.get(STORAGE_PREFIX + donationId, true);
                if (!result || !result.value) {
                    alert('Donation not found');
                    return;
                }

                const donation = JSON.parse(result.value);

                document.getElementById('editDonationId').value = donation.id;
                document.getElementById('editName').value = donation.name;
                document.getElementById('editAmount').value = donation.amount;
                document.getElementById('editMessage').value = donation.message || '';

                document.getElementById('editModal').classList.add('show');

            } catch (error) {
                console.error('Error loading donation for edit:', error);
                alert('Failed to load donation');
            }
        }

        // Handle edit submit
        async function handleEditSubmit(e) {
            e.preventDefault();

            const donationId = document.getElementById('editDonationId').value;
            const name = document.getElementById('editName').value.trim();
            const amount = parseFloat(document.getElementById('editAmount').value);
            const message = document.getElementById('editMessage').value.trim();

            if (!name || !amount || amount <= 0) {
                alert('Please enter valid name and amount');
                return;
            }

            try {
                // Get existing donation to preserve timestamp
                const result = await window.storage.get(STORAGE_PREFIX + donationId, true);
                const existingDonation = JSON.parse(result.value);

                const updatedDonation = {
                    id: donationId,
                    name: name,
                    amount: amount,
                    message: message,
                    timestamp: existingDonation.timestamp // Preserve original timestamp
                };

                await window.storage.set(
                    STORAGE_PREFIX + donationId,
                    JSON.stringify(updatedDonation),
                    true
                );

                closeEditModal();
                await loadAdminDashboard();
                alert('Donation updated successfully!');

            } catch (error) {
                console.error('Error updating donation:', error);
                alert('Failed to update donation');
            }
        }

        // Delete donation
        async function deleteDonation(donationId) {
            if (!confirm('Are you sure you want to delete this donation?')) {
                return;
            }

            try {
                await window.storage.delete(STORAGE_PREFIX + donationId, true);
                await loadAdminDashboard();
                alert('Donation deleted successfully!');

            } catch (error) {
                console.error('Error deleting donation:', error);
                alert('Failed to delete donation');
            }
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function copyUpi() {
            const upiText = document.getElementById('upiId').textContent;
            navigator.clipboard.writeText(upiText).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚úÖ Copied!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy UPI ID');
            });
        }

        // Handle browser back/forward
        window.addEventListener('hashchange', handleRoute);
    </script>
</body>

</html>